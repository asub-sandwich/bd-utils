#!/usr/bin/env bash
set -euo pipefail

IN="${1:-}"
OUT="${2:-}"

if [[ $# -ne 2 ]]; then
  echo "Usage: $0 <INPUT DIR> <OUTPUT DIR>" >&2
  exit 1
fi

if [[ ! -d "$IN" ]]; then
  echo "Error: INPUT DIR not found: $IN" >&2
  exit 1
fi

mkdir -p $OUT

find "$IN" -name "*.heic" | parallel --bar -I{} -j 8 \
  convert {} -quality 95 $OUT/{/.}.jpg
